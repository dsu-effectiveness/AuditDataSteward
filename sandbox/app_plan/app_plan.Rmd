---
title: "App Plan"
output: html_document
date: "2022-08-15"
author: "Matt Nickodemus"
---

```{r libraries, echo = FALSE, message = FALSE}
library(here)
library(png)
library(grid)
```


# Introduction

The Data Steward Audit Report lists all data points the Office of Institutional Effectiveness monitors. Each data point the OIE monitors is associated with a data steward. Several data points also are associated with last visit date. This date is take from the activity date field in the Banner table the data point originates from.  

## Metrics
The audit report presents the data stewards with five metrics.

- The total number of errors in data points for which they are the data steward.
- The average age of each error.
- The total number of data points for which they are the data steward.
- The percent of data errors associated with their data points.
- The number of tables containing data points over which they are the data steward.

## Tabs
These metrics are presented from several perspectives in the report. We currently have five perspectives. The faculty workload data points are not included in the current project we have with EAB. The structure for each tab, with the exception of the home tab, is identical, so they can all be made with one <a href="https://engineering-shiny.org/setting-up-for-success.html?q=modules#add-modules-in-dev02_dev.r">module</a>. The current tabs are

- home: This tab lists the totals of each metric.
- student: The data points associated with the USHE student file.
- courses: The data points associated with the USHE courses file.
- student-courses: The data points associated with the USHE student-courses file.
- faculty workload: The data points associated with the Universities faculty workload data.

### Functions

We will need three functions to create each element of the tabs.

- make_metric_row: This function will make the row of value boxes used in each tab. This function should take a user id as input and should return the five value boxes. The values for the value boxes can be calculated from the data frame generated by the package `utValidateR`. The colors of the value boxes will be the same for each tab and for each user. I recommend we use the <a href="https://rstudio.github.io/flexdashboard/reference/valueBox.html">value boxes</a> from the `flexdashboards` package.
 - make_summary_table: This function will make the summary table in each tab. This function should take a user id and a perspective as input and should return a table. These tables should be will be small, so I recommend we use the `gt` <a href = "https://gt.rstudio.com/">package</a>. A description of the data points in the table is given in the home tab section. Each data point should be associated with a perspective. We may need to manipulate the output of the `utValidateR` package to get it.
  - make_error_table: This function will make the error table for each tab. This function should take a user id and a perspective as input and should return a table. These tables will contain all the data errors from `utValidateR` associated with the perspective and the user. These should be obtainable from the `utValidateR` functions.

# Wireframe

## Home tab

The home tab is a summary tab which presents the data steward with a summary of all the errors they have in the data system. The structure of the home tab is the same as the other tabs, except that it is missing an error table.

```{r, fig.asp = .50, echo = FALSE}
home_tab <- readPNG(here::here("sandbox", "app_plan", "home_tab.png"))
grid.raster(home_tab)
```

### Value boxes

These should list the values for each of the five metrics for all the data associated with the data steward.

### Summary table

The summary table breaks down the value of each of the five metrics for each of the tables where the data elements are found. This should aid the data steward in finding the data in Banner. 

## Student tab

The structure of each of the tabs, with the exception of the home tab, is identical. Here we go over the student table as a standard example.

The summary table and the value boxes function the same as for the home tab. The only difference is that the summary tab and the value boxes display the metrics just for the data points associated with the student report/perspective. These perspectives will change as the audit report matures, so we want to build a process where reclassifying the data points to different perspectives is not burdensome. I think the best way to do this is to associate each data point with a perspective in a master spreadsheet in the `utValidate` package.

```{r, fig.asp = .50, echo = FALSE}
student_tab <- readPNG(here::here("sandbox", "app_plan", "student_tab.png"))
grid.raster(student_tab)
```

### Error table

This should take from the output of the functions in the `utValidateR` package. This could be a large table. I recommend that we use the `DT` package and have the filtering done server side. Here is an example of how I have done this in the past.

```{r eval = FALSE}
shinyServer(function(input, output, session) {

  mtcars2 = data.frame(
    name = rownames(mtcars), mtcars[, c('mpg', 'hp')],
    stringsAsFactors = FALSE
  )
  mtcars2$am = factor(mtcars$am, labels = c('automatic', 'manual'))
  mtcars2$date = Sys.Date() + seq_len(nrow(mtcars))

  output$tbl = DT::renderDataTable(
    mtcars2, filter = 'top', server = TRUE, rownames = FALSE,
    options = list(autoWidth = TRUE)
  )
})
```

